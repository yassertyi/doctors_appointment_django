
{% block content %}

<div class="col-md-7 col-lg-8 col-xl-9 section invoices d-none">
    <div class="row">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-body">
                        <div class="invoice-details">
                            <!-- Hospital Information -->
                            <div class="row mb-4">
                                <div class="col-md-6">
                                    <h4>معلومات المستشفى</h4>
                                    <p><strong>الاسم:</strong> {{ hospital.name }}</p>
                                    <p><strong>الموقع:</strong> {{ hospital.location }}</p>
                                </div>
                                <div class="col-md-6 text-end">
                                    <h4>معلومات الفاتورة</h4>
                                    <p><strong>رقم الفاتورة:</strong> #INV-{{ invoice.id }}</p>
                                    <p><strong>تاريخ الفاتورة:</strong> {{ invoice.payment_date|date:"d M Y" }}</p>
                                    <p><strong>الحالة:</strong> 
                                        <span class="badge {% if invoice.payment_status.payment_status_name == 'completed' %}bg-success{% else %}bg-warning{% endif %}">
                                            {{ invoice.payment_status.payment_status_name }}
                                        </span>
                                    </p>
                                </div>
                            </div>

                            <!-- Patient Information -->
                            <div class="row mb-4">
                                <div class="col-md-6">
                                    <h4>معلومات المريض</h4>
                                    <p><strong>الاسم:</strong> {{ invoice.booking.patient.get_full_name }}</p>
                                    <p><strong>رقم المريض:</strong> #PT{{ invoice.booking.patient.id }}</p>
                                    <p><strong>رقم الهاتف:</strong> {{ invoice.booking.patient.phone_number }}</p>
                                </div>
                                <div class="col-md-6">
                                    <h4>معلومات الطبيب</h4>
                                    <p><strong>الاسم:</strong> د. {{ invoice.booking.doctor.full_name }}</p>
                                    <p><strong>التخصص:</strong> {{ invoice.booking.doctor.specialty.name }}</p>
                                </div>
                            </div>

                            <!-- Appointment Details -->
                            <div class="row mb-4">
                                <div class="col-12">
                                    <h4>تفاصيل الموعد</h4>
                                    <p><strong>تاريخ الموعد:</strong> {{ invoice.booking.appointment_datetime|date:"d M Y" }}</p>
                                    <p><strong>وقت الموعد:</strong> {{ invoice.booking.appointment_datetime|date:"h:i A" }}</p>
                                    <p><strong>حالة الحجز:</strong> {{ invoice.booking.status }}</p>
                                </div>
                            </div>

                            <!-- Payment Details -->
                            <div class="row mb-4">
                                <div class="col-12">
                                    <h4>تفاصيل الدفع</h4>
                                    <div class="table-responsive">
                                        <table class="table table-bordered">
                                            <tbody>
                                                <tr>
                                                    <td><strong>طريقة الدفع:</strong></td>
                                                    <td>{{ invoice.payment_method.payment_option.method_name }}</td>
                                                </tr>
                                                <tr>
                                                    <td><strong>نوع الدفع:</strong></td>
                                                    <td>{{ invoice.get_payment_type_display }}</td>
                                                </tr>
                                                <tr>
                                                    <td><strong>المبلغ الفرعي:</strong></td>
                                                    <td>{{ invoice.payment_currency }} {{ invoice.payment_subtotal }}</td>
                                                </tr>
                                                <tr>
                                                    <td><strong>الخصم:</strong></td>
                                                    <td>{{ invoice.payment_currency }} {{ invoice.payment_discount }}</td>
                                                </tr>
                                                <tr>
                                                    <td><strong>المبلغ الإجمالي:</strong></td>
                                                    <td><strong>{{ invoice.payment_currency }} {{ invoice.payment_totalamount }}</strong></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>

                            {% if invoice.payment_note %}
                            <!-- Payment Notes -->
                            <div class="row">
                                <div class="col-12">
                                    <h4>ملاحظات</h4>
                                    <p>{{ invoice.payment_note }}</p>
                                </div>
                            </div>
                            {% endif %}

                            <!-- Actions -->
                            <div class="row mt-4">
                                <div class="col-12 text-end">
                                    <a href="{% url 'hospitals:index' %}" class="btn btn-secondary">
                                        <i class="fas fa-arrow-left"></i> العودة للقائمة
                                    </a>
                                    <button type="button" class="btn btn-primary print-invoice" data-invoice-id="{{ invoice.id }}">
                                        <i class="fas fa-print"></i> طباعة الفاتورة
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


{% endblock %}


{% block scripts %}
<script>
$(document).ready(function() {
    // Handle print button
    $('.print-invoice').on('click', function() {
        window.print();
    });
});
</script>
{% endblock %}
