<div class="col-md-7 col-lg-8 col-xl-9 invoices section d-none">
    <div class="card card-table">
        <div class="card-body">
            <!-- Filter Section -->
            <div class="row mb-4">
                <div class="col-md-12">
                    <form id="invoice-filter-form" class="row">
                        <div class="col-md-3 mb-2">
                            <label>From Date</label>
                            <input type="date" name="date_from" class="form-control" value="{{ request.GET.date_from }}">
                        </div>
                        <div class="col-md-3 mb-2">
                            <label>To Date</label>
                            <input type="date" name="date_to" class="form-control" value="{{ request.GET.date_to }}">
                        </div>
                        <div class="col-md-3 mb-2">
                            <label>Payment Status</label>
                            <select name="payment_status" class="form-control">
                                <option value="">All</option>
                                {% for status in payment_statuses %}
                                    <option value="{{ status.id }}" {% if request.GET.payment_status == status.id|stringformat:"s" %}selected{% endif %}>
                                        {{ status.payment_status_name }}
                                    </option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-3 mb-2">
                            <label>Amount Range</label>
                            <div class="input-group">
                                <input type="number" name="amount_min" class="form-control" placeholder="Min" value="{{ request.GET.amount_min }}">
                                <input type="number" name="amount_max" class="form-control" placeholder="Max" value="{{ request.GET.amount_max }}">
                            </div>
                        </div>
                        <div class="col-md-12 text-end">
                            <button type="submit" class="btn btn-primary">Filter</button>
                            <button type="button" class="btn btn-secondary" id="reset-filter">Reset</button>
                        </div>
                    </form>
                </div>
            </div>
            
            <!-- Invoice Table -->
            <div class="table-responsive" id="invoice-table-container">
                <table class="table table-hover table-center mb-0">
                    <thead>
                        <tr>
                            <th>Invoice No</th>
                            <th>Patient</th>
                            <th>Amount</th>
                            <th>Status</th>
                            <th>Paid On</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for invoice in invoices %}
                        <tr>
                            <td>
                                <a href="#">#INV-{{ invoice.id }}</a>
                            </td>
                            <td>
                                <h2 class="table-avatar">
                                    {% if invoice.booking.patient.profile_image %}
                                    <a href="#" class="avatar avatar-sm me-2">
                                        <img class="avatar-img rounded-circle" src="{{ invoice.booking.patient.profile_image.url }}" alt="Patient Image">
                                    </a>
                                    {% endif %}
                                    <a href="#">{{ invoice.booking.patient.get_full_name }} <span>#PT{{ invoice.booking.patient.id }}</span></a>
                                </h2>
                            </td>
                            <td>${{ invoice.payment_totalamount }}</td>
                            <td>
                                <span class="badge {% if invoice.payment_status.payment_status_name == 'completed' %}bg-success{% else %}bg-warning{% endif %}">
                                    {{ invoice.payment_status.payment_status_name }}
                                </span>
                            </td>
                            <td>{{ invoice.payment_date|date:"d M Y" }}</td>
                            <td>
                                <div class="table-action">
                                    <a href="#" class="btn btn-sm bg-info-light view-invoice" data-invoice-id="{{ invoice.id }}">
                                        <i class="far fa-eye"></i> View
                                    </a>
                                    <a href="#" class="btn btn-sm bg-primary-light print-invoice" data-invoice-id="{{ invoice.id }}">
                                        <i class="fas fa-print"></i> Print
                                    </a>
                                </div>
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="6" class="text-center">No invoices found</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            <!-- /Invoice Table -->
        </div>
    </div>
</div>

<script>
$(document).ready(function() {
    function loadInvoices(formData) {
        $.ajax({
            url: '{% url "hospitals:filter_invoices" %}',
            type: 'GET',
            data: formData,
            success: function(response) {
                $('#invoice-table-container').html(response);
            },
            error: function(xhr, status, error) {
                console.error("Error loading invoices:", error);
            }
        });
    }

    // Handle form submission
    $('#invoice-filter-form').on('submit', function(e) {
        e.preventDefault();
        var formData = $(this).serialize();
        loadInvoices(formData);
    });

    // Handle reset button
    $('#reset-filter').on('click', function() {
        $('#invoice-filter-form')[0].reset();
        loadInvoices('');
    });
});
</script>