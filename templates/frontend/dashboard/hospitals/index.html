{% extends "frontend/layouts/master.html" %}
{% load static %}
{% load widget_tweaks %}

{% block content %}
<!-- Breadcrumb -->
<div class="breadcrumb-bar-two">
  <div class="container">
    <div class="row align-items-center inner-banner">
      <div class="col-md-12 col-12 text-center">
        <h2 class="breadcrumb-title">لوحة التحكم</h2>
        <nav aria-label="breadcrumb" class="page-breadcrumb">
          <ol class="breadcrumb">
            <li class="breadcrumb-item">
              <a href="{% url 'home:home' %}">Home</a>
            </li>
            <li class="breadcrumb-item active" aria-current="page">
              Doctor Blog
            </li>
          </ol>
        </nav>
      </div>
    </div>
  </div>
</div>
<!-- /Breadcrumb -->

<!-- Page Content -->
<div class="content">
  <div class="container">
    <div class="row">
      <div class="col-md-5 col-lg-4 col-xl-3 theiaStickySidebar">
        <!-- Profile Sidebar -->
        <div class="profile-sidebar">
          <div class="widget-profile pro-widget-content">
            <div class="profile-info-widget">
              {% if request.user.profile_picture %}
              <a href="#" class="booking-doc-img">
                <img src="{{request.user.profile_picture.url}}" alt="User Image" />
              </a>
              {% endif %}
              <div class="profile-det-info">
                <h3>{{hospital.name}}</h3>
                <div class="patient-details">
                  <h5 class="mb-0">{{hospital.sub_title}}</h5>
                  {% if request.user.user_type == 'hospital_staff' %}
                  <h6 class="text-primary mt-2">
                    <i class="fas fa-user-tie"></i> موظف: {{ request.user.get_full_name }}
                  </h6>
                  {% if staff_obj %}
                  <p class="text-muted small">
                    <i class="fas fa-briefcase"></i> {{ staff_obj.job_title }}
                    {% if staff_obj.role %}
                    <br><i class="fas fa-user-tag"></i> {{ staff_obj.role.name }}
                    {% endif %}
                  </p>
                  {% endif %}
                  {% endif %}
                </div>
              </div>
            </div>
          </div>
          <div class="dashboard-widget">
            <nav class="dashboard-menu">
              <ul>
                <li>
                  <a href="javascript:;" data-method="hospital_dashboard" data-section="hospital_dashboard">
                    <i class="fas fa-columns"></i>
                    <span>لوحة التحكم</span>
                  </a>
                </li>
                <li>
                  <a href="javascript:;" data-method="all_doctors_page" data-section="all_doctors_page">
                    <i class="fas fa-calendar-check"></i>
                    <span>الاطباء</span>
                  </a>
                </li>
                
                <li>
                  <a href="javascript:;" data-method="schedule_timings" data-section="schedule_timings">
                    <i class="fas fa-clock"></i>
                    <span>جدولة المواعيد</span>
                  </a>
                </li>
                <li>
                  <a href="javascript:;" data-method="appointments" data-section="appointments">
                    <i class="fas fa-calendar-check"></i>
                    <span>الحجوزات</span>
                  </a>
                </li>
                <li>
                  <a href="javascript:;" data-method="my_patient" data-section="my_patient">
                    <i class="fas fa-user-injured"></i>
                    <span>المرضى</span>
                  </a>
                </li>
                <li>
                  <a href="javascript:;" data-method="invoices_table" data-section="invoices_table">
                    <i class="fas fa-file-invoice"></i>
                    <span>الفواتير</span>
                  </a>
                </li>

                <li>
                  <a href="{% url 'hospitals:blog_list' %}">
                    <i class="fas fa-comments"></i>
                    <span>المدونة</span>
                  </a>
                </li>
                <li>
                  <a href="javascript:;" data-method="payment_settings" data-section="payment_settings">
                    <i class="fas fa-credit-card"></i>
                    <span> اعدادات طرق الدفع</span>
                  </a>
                </li>
                {% if request.user.user_type == 'hospital_manager' %}
                <li>
                  <a href="javascript:;" data-method="staff_list" data-section="staff_list">
                    <i class="fas fa-users"></i>
                    <span>إدارة الموظفين</span>
                  </a>
                </li>
                {% endif %}
                <li>
                  <a href="javascript:;" data-method="doctor_profile_settings" data-section="doctor_profile_settings">
                    <i class="fas fa-user-cog"></i>
                    <span>إعدادات الملف الشخصي</span>
                  </a>
                </li>
                <li>
                  <a href="javascript:;" data-method="notifications_list">
                    <i class="fas fa-comments"></i>
                    <span>الأشعارات</span>
                    <small class="unread-msg">{{ notifications.count }}</small>
                  </a>
                </li>
                <li>
                  <a href="javascript:;" data-method="notifications_forms">
                    <i class="fas fa-comments"></i>
                    <span>ارسال اشعار</span>
                  </a>
                </li>
                <li>
                  <a href="javascript:;" data-method="doctor_change_password" data-section="doctor_change_password">
                    <i class="fas fa-lock"></i>
                    <span>تغيير كلمة المرور</span>
                  </a>
                </li>
                <li>
                  <a href="{% url 'hospitals:logout' %}">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>تسجيل الخروج</span>
                  </a>
                </li>
              </ul>
            </nav>
          </div>
        </div>
        <!-- /Profile Sidebar -->
      </div>

      <!-- Include Sections -->
      {% include "frontend/dashboard/hospitals/sections/staff/staff-list.html" %}
      {% include "frontend/dashboard/hospitals/sections/schedule-timings.html" %}
      {% include "frontend/dashboard/hospitals/sections/all_doctors_page.html" %}
      {% include "frontend/dashboard/hospitals/sections/my-patients.html" %}
      {% include "frontend/dashboard/hospitals/sections/invoice_table.html" %}
      {% include "frontend/dashboard/hospitals/sections/notifications.html" %}
      {% include "frontend/dashboard/hospitals/sections/notifications-forms.html" %}
      {% include "frontend/dashboard/hospitals/sections/add_payment_page.html" %}
      {% include "frontend/dashboard/hospitals/sections/payment_settings.html" %}
      {% include "frontend/dashboard/hospitals/sections/hospitals-profile-settings.html" %}
      {% include "frontend/dashboard/hospitals/sections/hospitals-password.html" %}
      {% include "frontend/dashboard/hospitals/sections/hospitals-dashboard.html" %}
      {% include "frontend/dashboard/hospitals/sections/appointments.html" %}
      {% include "frontend/dashboard/hospitals/sections/hospitals-pending-blog.html" %}
      
    </div>
  </div>
</div>
<!-- /Page Content -->

{% endblock %}

{% block extra_js %}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
  $(document).ready(function () {
    // دالة لتحديث عنوان الصفحة في breadcrumb
    function updateBreadcrumb(title) {
      $(".breadcrumb-title").text(title);
      $(".breadcrumb-item.active").text(title);
    }

    // دالة للتعامل مع الروابط
    function handleLinkClick(e) {
      const methodName = $(this).data("method");

      if (methodName === "logout") {
        e.preventDefault();
        const confirmLogout = confirm("هل أنت متأكد أنك تريد تسجيل الخروج؟");
        if (confirmLogout) {
          window.location.href = $(this).attr("href");
        }
      } else {
        e.preventDefault();
        const sectionTitles = {
          hospital_dashboard: "لوحة التحكم",
          all_doctors_page: "جميع الأطباء",
          schedule_timings: "جدولة المواعيد",
          appointments: "الحجوزات",
          my_patient: "المرضى",
          invoices_table: "الفواتير",
          payment_settings: "إعدادات الدفع",
          doctor_profile_settings: "إعدادات الملف الشخصي",
          notifications_list: "الأشعارات",
          notifications_forms: "ارسال اشعار",
          doctor_change_password: "تغيير كلمة المرور",
          staff_list: "إدارة الموظفين"
        };

        const newTitle = sectionTitles[methodName] || "لوحة التحكم";
        updateBreadcrumb(newTitle);

        // إعادة تحميل الصفحة مع إضافة بارامتر للقسم المطلوب
        const currentUrl = window.location.href.split('?')[0];
        window.location.href = currentUrl + '?section=' + methodName;
      }
    }

    // التعامل مع الروابط
    $("a[data-method]").on("click", handleLinkClick);

    // عند تحميل الصفحة، التحقق من وجود قسم معين في URL
    const urlParams = new URLSearchParams(window.location.search);
    const sectionParam = urlParams.get('section');

    // تعريف عناوين الأقسام
    const sectionTitles = {
      hospital_dashboard: "لوحة التحكم",
      all_doctors_page: "جميع الأطباء",
      schedule_timings: "جدولة المواعيد",
      appointments: "الحجوزات",
      my_patient: "المرضى",
      invoices_table: "الفواتير",
      payment_settings: "إعدادات الدفع",
      doctor_profile_settings: "إعدادات الملف الشخصي",
      notifications_list: "الأشعارات",
      notifications_forms: "ارسال اشعار",
      doctor_change_password: "تغيير كلمة المرور",
      staff_list: "إدارة الموظفين"
    };

    // تحديد القسم المطلوب عرضه
    let currentSection = sectionParam || 'hospital_dashboard';

    // تحديث عنوان الصفحة
    const title = sectionTitles[currentSection] || "لوحة التحكم";
    updateBreadcrumb(title);

    // إخفاء جميع الأقسام وإظهار القسم المطلوب
    $(".section").addClass("d-none");
    $(`.${currentSection}`).removeClass("d-none");

    // تحديث القائمة النشطة
    $(".dashboard-menu li").removeClass("active");
    $(`a[data-method="${currentSection}"]`).parent().addClass("active");
  });
</script>
{% endblock %}
